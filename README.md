# kafka-mirrormaker-azure-tutorial

<table><tbody><tr><td>Step</td><td>Description</td></tr><tr><td>1.</td><td><p>Prerequisite:&nbsp;</p><ul><li>Ubuntu 20.04 (for example on Windows 10 with WSL 2)</li><li>MS Visual Studio Code</li><li>Microsoft Azure subscription</li></ul></td></tr><tr><td>2.</td><td><p><strong>Install java on Ubuntu 20.04</strong></p><p>$ sudo apt update</p><p>$&nbsp;sudo apt install openjdk-8-jdk -y</p><p>$&nbsp;java -version</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108631882-74cfd680-746c-11eb-8f1f-8ba0fa6cb4b2.png"></figure><p>$&nbsp;export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</p><p>$&nbsp;export PATH=$PATH:$JAVA_HOME/bin</p></td></tr><tr><td>3.</td><td><p><strong>Install Apache Kafka on Ubuntu 20.04</strong></p><p>$&nbsp;mkdir kafka</p><p>$&nbsp;cd kafka</p><p>$&nbsp;wget <a href="https://downloads.apache.org/kafka/2.7.0/kafka_2.13-2.7.0.tgz">https://downloads.apache.org/kafka/2.7.0/kafka_2.13-2.7.0.tgz</a></p><p>$&nbsp;tar -zxf kafka_2.13-2.7.0.tgz</p><p>$&nbsp;sudo mv kafka_2.13-2.7.0 /usr/local/kafka</p><p>$&nbsp;sudo mkdir /tmp/kafka-logs</p><p>$&nbsp;sudo mkdir /tmp/zookeeper</p></td></tr><tr><td>4.</td><td><p><strong>Start Apache Zookeeper on Ubuntu 20.04</strong></p><p>$ sudo /usr/local/kafka/bin/zookeeper-server-start.sh /usr/local/kafka/config/zookeeper.properties</p></td></tr><tr><td>5.</td><td><p><strong>Start Apache Kafka Server on Ubuntu 20.04</strong></p><p>$ sudo /usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties</p></td></tr><tr><td>6.</td><td><p><strong>Create Kafka topic on Ubuntu 20.04:</strong></p><p>$ /usr/local/kafka/bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092</p><p>$ /usr/local/kafka/bin/kafka-topics.sh --create --topic mymachine --bootstrap-server localhost:9092</p><p>$ /usr/local/kafka/bin/kafka-topics.sh --list --bootstrap-server &nbsp;localhost:9092</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108633264-9aaca980-7473-11eb-8798-59a2a2c4089d.png"></figure></td></tr><tr><td>7.</td><td><p><strong>Microsoft Azure Event-Hub:</strong></p><p>Create a resource</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108899070-47c02700-7618-11eb-92d7-1d4e53b602dc.png"></figure><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108899264-8524b480-7618-11eb-8348-2f98ff3cfc0f.png"></figure><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108899506-c9b05000-7618-11eb-9b0d-ec28758e5861.png"></figure><p>Create</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108900276-bc479580-7619-11eb-8b20-6c586b28af66.png"></figure><p>You have to create a standard tier Event Hubs namespace: the Kafka endpoint for the namespace is automatically enabled.</p><p>Next: Features &gt; &nbsp;Next: Tags &gt; Next: Review + create &gt; Create</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108902321-4264db80-761c-11eb-8eb4-609d9b64ff3f.png"></figure><p>Go to resource</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108902458-67f1e500-761c-11eb-8481-3e1762524ca7.png"></figure><p>Click on&nbsp;</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108902538-87890d80-761c-11eb-9ecf-e6db2b5b5ce9.png"></figure><p>and copy the "Connection stringâ€“primary key" (e.g. Endpoint=sb://kafkaazure.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=[your key]) for later use.</p><p>&nbsp;</p></td></tr><tr><td>8.&nbsp;</td><td><p><strong>MirrorMaker on Ubuntu 20.04</strong></p><p>$ cd /usr/local/kafka/config</p><p>$ code .</p><p>Visual Studio Code opens. Create File / New File and enter the following configuration:</p><p>bootstrap.servers=localhost:9092</p><p>exclude.internal.topics=true</p><p>client.id=mirror_maker_consumer<br>group.id=mirror_maker_consumer</p><p>File / Save as sourceCluster1Consumer.config</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108904327-a5577200-761e-11eb-9138-18e4ec25d09f.png"></figure><p>Create File / New File and enter the following configuration:</p><p>bootstrap.servers=kafkaazure.servicebus.windows.net:9093<br>security.protocol=SASL_SSL<br>sasl.mechanism=PLAIN<br>sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="$ConnectionString" password="Endpoint=sb://kafkaazure.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=[your key];</p><p>acks=1</p><p>batch.size=50</p><p>client.id=mirror_maker_test_producer</p><p>File / Save as azureClusterProducer.config</p><figure class="image"><img src="https://user-images.githubusercontent.com/51634515/108905062-89a09b80-761f-11eb-8f86-3d5e22213007.png"></figure><p>$ sudo /usr/local/kafka/bin/kafka-mirror-maker.sh --consumer.config /usr/local/kafka/config/sourceCluster1Consumer.config --num.streams 1 --producer.config /usr/local/kafka/config/azureClusterProducer.config --whitelist=".*"</p></td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table>
